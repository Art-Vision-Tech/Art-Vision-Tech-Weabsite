<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="./js/sessao.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter">
    <title>Tela de Cadastro</title>
    <link rel="stylesheet" href="css/styles_cadastro.css">
</head>

<body onload="listar()">
    <div class="container">
        <div class="quadro1">
            <div class="texto-quadro1">
                <h1 class="titulo1">Bem-Vindo!</h1>
                <p class="titulo2">A ArtVision Tech Software</p>
            </div>
        </div>
        <div class="quadro2">
            <div class="container-quadro2">
                <h1 class="titulo">Registre-se</h1>
                <div class="formulario">
                    <div class="campos">
                        <input type="text" id="input_nome" placeholder="Nome">
                        <div id="div_nome"></div>
                    </div>
                    <div class="campos">
                        <input type="text" id="input_email" placeholder="Email">
                        <div id="div_nome"></div>
                    </div>
                    <div class="campos">
                        <span>Empresas</span>
                        <select id="listaMuseus">
                            <option selected></option>
                        </select>
                        <div id="div_email"></div>
                    </div>
                    <div class="campos">
                        <input id="input_CPF" max="11" placeholder="CPF">
                        <div id="div_cpf"></div>
                    </div>
                    <div class="campos">
                        <input type="password" id="input_senha" placeholder="Senha">
                        <div id="div_senha"></div>
                    </div>
                </div>
                <button onclick="cadastrar()" class="botao">Criar conta</button>
                <div class="form-footer">

                    <b class="registro">Já possui uma conta? <a href="login.html" style="text-decoration: none;"> <span
                                style="color: #8c2a44; "><b>Login</b></span>
                        </a></b>


                </div>
            </div>
        </div>
    </div>
</body>

</html>
<script>
    function cadastrar() {
        /* aguardar(); */

        //Recupere o valor da nova input pelo nome do id
        // Agora vá para o método fetch logo abaixo
        var nomeVar = input_nome.value;
        var emailVar = input_email.value;
        var cpfVar = input_CPF.value;
        var senhaVar = input_senha.value;
        var museusVar = listaMuseus.value
        if (
            (nomeVar == "" && nomeVar.lenght <= 1) ||
            (emailVar == "" && emailVar.indexOf('@') <= 0 && emailVar.indexOf('.') <= 0) ||
            (cpfVar == "" && cpf != 14) ||
            (senhaVar == "") ||
            museusVar == ""
        ) {
            alert( "(Mensagem de erro para todos os campos em branco)");
            /* finalizarAguardar(); */
            return false;
        } /* else {
            setInterval(sumirMensagem, 5000);
        } */

        // Enviando o valor da nova input
        fetch("/usuarios/cadastrar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                nomeServer: nomeVar,
                cpfServer: cpfVar,
                emailServer: emailVar,
                senhaServer: senhaVar,
                museuServer: museusVar
            }),
        })
            .then(function (resposta) {
                console.log("resposta: ", resposta);

                if (resposta.ok) {
                    alert("Cadastro realizado com sucesso! Redirecionando para tela de Login...")
                        
                    setTimeout(() => {
                        window.location = "login.html";
                    }, "2000");

                    limparFormulario();
/*                     finalizarAguardar(); */
                } else {
                    throw "Houve um erro ao tentar realizar o cadastro!";
                }
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
                /* finalizarAguardar(); */
            });

        return false;
    }


    function listar() {
        fetch("/museus/listar", {
            method: "GET",
        })
            .then(function (resposta) {
                resposta.json().then((museus) => {
                    museus.forEach((museu) => {
                        listaMuseus.innerHTML += `<option value='${museu.idMuseu}'>${museu.cnpj}</option>`;
                    });
                });
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
            });
    }

/*     function sumirMensagem() {
        cardErro.style.display = "none";
    } */
</script>