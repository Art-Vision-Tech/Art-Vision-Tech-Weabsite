<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="./js/sessao.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter">
    <title>Tela de Cadastro</title>
    <link rel="stylesheet" href="css/styles_cadastro.css">
</head>

<body onload="listar()">
    <div class="container">
        <div class="quadro1">
            <div class="texto-quadro1">
                <h1 class="titulo1">Bem-Vindo!</h1>
                <p class="titulo2">A ArtVision Tech Software</p>
            </div>
        </div>
        <div class="quadro2">
            <div class="container-quadro2">
                <h1 class="titulo">Registre-se</h1>
                <div class="formulario">
                    <div class="campos">
                        <input type="text" id="input_nome" placeholder="Nome">
                        <div id="div_nome"></div>
                    </div>
                    
                    <div class="campos">
                        <input type="text" id="input_email" placeholder="Email">
                        <div id="div_email"></div>
                    </div>
                    
                    <div class="campos">
                        
                        <input type="number" id="listaMuseus" placeholder="CNPJ" max="14">
                    </input>
                    <div id="div_cnpj"></div>
                    </div>

                    <div class="campos">
                        <input id="input_CPF" placeholder="CPF" max="11">
                        <div id="div_cpf"></div>
                    </div>
                    <div class="campos">
                        <input type="password" id="input_senha" placeholder="Senha">
                        <div id="div_senha"></div>
                    </div>
                </div>
                <button onclick="cadastrar()" class="botao">Criar conta</button>
                <div class="form-footer">

                    <b class="registro">Já possui uma conta? <a href="login.html" style="text-decoration: none;"> <span
                                style="color: #8c2a44; "><b>Login</b></span>
                        </a></b>


                </div>
            </div>
        </div>
    </div>
</body>

</html>
<script>
    function cadastrar() {
        /* aguardar(); */

        //Recupere o valor da nova input pelo nome do id
        // Agora vá para o método fetch logo abaixo
        var nomeVar = input_nome.value;
        var emailVar = input_email.value;
        var cnpjVar = listaMuseus.value;
        var cpfVar = input_CPF.value;
        var senhaVar = input_senha.value;
        var museusVar = listaMuseus.value;

        div_cpf.innerHTML = ""
        div_email.innerHTML = ""
        div_cnpj.innerHTML = ""
        div_senha.innerHTML = ""
        div_nome.innerHTML = ""



        var nome_especial =
            nomeVar.indexOf('1') >= 0 || nomeVar.indexOf('2') >= 0 ||
            nomeVar.indexOf('3') >= 0 || nomeVar.indexOf('4') >= 0 ||
            nomeVar.indexOf('5') >= 0 || nomeVar.indexOf('7') >= 0 ||
            nomeVar.indexOf('8') >= 0 || nomeVar.indexOf('9') >= 0 ||
            nomeVar.indexOf('0') >= 0 || nomeVar.indexOf('!') >= 0 ||
            nomeVar.indexOf('@') >= 0 || nomeVar.indexOf('6') >= 0 ||
            nomeVar.indexOf('#') >= 0 || nomeVar.indexOf('%') >= 0 ||
            nomeVar.indexOf('¨') >= 0 || nomeVar.indexOf('&') >= 0 ||
            nomeVar.indexOf('*') >= 0 || nomeVar.indexOf('-') >= 0 ||
            nomeVar.indexOf('(') >= 0 || nomeVar.indexOf('_') >= 0 ||
            nomeVar.indexOf(')') >= 0 || nomeVar.indexOf('+') >= 0 ||
            nomeVar.indexOf('$') >= 0 || nomeVar.indexOf('=') >= 0 ||
            nomeVar.indexOf('ç') >= 0 || nomeVar.indexOf(',') >= 0 ||
            nomeVar.indexOf('{') >= 0 || nomeVar.indexOf(':') >= 0 ||
            nomeVar.indexOf('}') >= 0 || nomeVar.indexOf(';') >= 0 ||
            nomeVar.indexOf('[') >= 0 || nomeVar.indexOf('|') >= 0 ||
            nomeVar.indexOf('/') >= 0 || nomeVar.indexOf('º') >= 0 ||
            nomeVar.indexOf('?') >= 0 || nomeVar.indexOf('°') >= 0;


        if (nomeVar == "" || emailVar == "" || cnpjVar == "" || cpfVar == "" ||
            senhaVar == "" || museusVar == "") {
            alert("Não é permitido campos em branco")
        }

        if (nomeVar == "") {
            div_nome.innerHTML = '<span style= "color: red";> Este campo não pode ficar vazio <br></span>'
        } else {

        }
        if (emailVar == "") {
            div_email.innerHTML = '<span style= "color: red";> Este campo não pode ficar vazio <br></span>'
        } else {

        }
        if (museusVar=="") {
            div_empresa.innerHTML = '<span style= "color: red";> Este campo não pode ficar vazio <br></span>'
        } else {
            div_nome.innerHTML += " "
        }

        if (nome_especial) {
            div_nome.innerHTML = '<span style= "color: red";> O Nome deve conter apenas letras <br></span>'
        } else {
            div_nome.innerHTML += " "
        }
        if (cpfVar.length != 11) {
            div_cpf.innerHTML = '<span style= "color: red";> Numero de CPF invalido</span>'
        }
        else {
            div_cpf.innerHTML += " "
        }
        if (senhaVar.length < 8) {
            div_senha.innerHTML = '<span style= "color: red";> A senha deve conter pelo menos oito digitos</span>'
        } else {
            div_senha.innerHTML += " "
        }
        if (cnpjVar.length < 14) {
            div_cnpj.innerHTML = `<span style= "color: red";> Numero de CNPJ invalido</span>`
        } else {
        
        }


        // Enviando o valor da nova input
        fetch("/usuarios/cadastrar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                nomeServer: nomeVar,
                cpfServer: cpfVar,
                cnpjServer: cnpjVar,
                emailServer: emailVar,
                senhaServer: senhaVar,
                museuServer: museusVar
            }),
        })
            .then(function (resposta) {
                console.log("resposta: ", resposta);

                if (resposta.ok) {
                    alert("Cadastro realizado com sucesso! Redirecionando para tela de Login...")

                    setTimeout(() => {
                        window.location = "login.html";
                    }, "2000");

                    limparFormulario();
                    /*                     finalizarAguardar(); */
                } else {
                    throw "Houve um erro ao tentar realizar o cadastro!";
                }
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
                /* finalizarAguardar(); */
            });

        return false;
    }


    function listar() {
        fetch("/museus/listar", {
            method: "GET",
        })
            .then(function (resposta) {
                resposta.json().then((museus) => {
                    museus.forEach((museu) => {
                        listaMuseus.innerHTML += `<option value='${museu.idMuseu}'>${museu.cnpj}</option>`;
                    });
                });
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
            });
    }

    /*     function sumirMensagem() {
            cardErro.style.display = "none";
        } */
</script>