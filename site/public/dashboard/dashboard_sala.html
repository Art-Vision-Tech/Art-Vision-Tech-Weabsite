<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <!-- Link onde são fornecidos os ícones  -->
    <link href='https://fonts.googleapis.com/css?family=Inter' rel='stylesheet'>
    <!-- Link para o google fonts, por enquanto estaremos utilizando a fonte 'Inter' -->
    <link rel="stylesheet" href="../css/sistema_style.css">
    <!-- Css padrão para a estilização da parte do sistema do site -->
    <link rel="stylesheet" href="../css/dashboard_sala.css">
    <!-- Css padrão para a estilização da parte do sistema do site -->
    <title>Dashboard Sala</title>
</head>

<body>
    <div class="header">
        <div id="perfil">
            <p> Henrique </p>
            <img id="perfil-avatar" src="https://cdn-icons-png.flaticon.com/512/3106/3106773.png" alt="Foto de perfil">
        </div>
    </div>
    <div id="sidebar"> <!-- Div que representa o elemento menu  -->
        <img id="logo" src="../assets/img/logo_museu.png" alt="Logo Museu">
        <!-- Imagem da logo do museus cadastrado no sistema -->
        <div id="sidebar-menu">
            <a class="active" href="sensores.html"> <i class="fa fa-fw fa-solid fa-table-cells-large"></i> Sensores
                <a href="linha_do_tempo.html"> <i class="fa fa-fw fa-solid fa-timeline"></i> Linha do Tempo </a>
                <a href="relatorio.html"> <i class="fa fa-fw fa-regular fa-clipboard"></i> Relatório </a>
                <a href="ajustes.html"> <i class="fa fa-fw fa-solid fa-gear"></i> Ajustes </a>
            </a>
            <a> <i class="fa fa-fw fa-solid fa-arrow-right-from-bracket"></i> Sair </a>
        </div>
    </div>
    <div class="rigth-content"> <!-- Seção onde será inserido o conteúdo do sistema-->
        <div class="container-bg-content">
            <div class="container-header">
                <p> <a href="dashboard.html"> <i class="fa fa-fw fa-solid fa-arrow-left"></i> </a> Galeria de arte 2°
                    andar - norte </p>
            </div> 
            <div class="container-main-content">
                <div class="container-row row1">
                    <div class="container-column">
                        <div class="grafico">
                            <canvas id="kpi_chart"></canvas>
                            <canvas id="kpi_chartUmd" style="display: none;"></canvas>
                        </div>
                        <div>
                            <select name="select_grafico" id="select_grafico" onchange="tipoGrafico()">
                                <option value="opt_temp"> Temperatura </option>
                                <option value="opt_umd"> Umidade </option>
                            </select>
                            <!-- <button class="botao-select" > Atualizar </button> -->
                        </div>
                        <table class="tabela-sensor">
                            <thead>
                                <tr>
                                    <th> ID </th>
                                    <th> Sensor </th>
                                    <th> Temperatura </th>
                                    <th> Umidade </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>1</td>
                                    <td>DHT11(1)</td>
                                    <td>19º</td>
                                    <td>40%</td>
                                </tr>
                                <tr>
                                    <td>2</td>
                                    <td>DHT11(2)</td>
                                    <td>20º</td>
                                    <td>45%</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="container-log">
                        <div class="log-header">
                            <p> Histórico de Alertas </p>
                        </div>
                        <div class="log-mensagem">
                            <i class="fa-solid fa-circle-exclamation" style="color: #ff1414;"></i>
                            <p> Nível de temperatura registrado “+6º” do que esperado
                                (03-09-2023 15:24 ) </p>
                        </div>
                        <div class="log-mensagem">
                            <i class="fa-solid fa-circle-exclamation" style="color: #ff1414;"></i>
                            <p> Nível de umidade registrado “+3%” do que esperado
                                (03-09-2023 04:02 )</p>
                        </div>
                        <div class="log-mensagem">
                            <i class="fa-solid fa-circle-exclamation" style="color: #ff1414;"></i>
                            <p> Nível de umidade registrado “+4%” do que esperado
                                (03-09-2023 03:52 ) </p>
                        </div>
                        <div class="log-mensagem">
                            <i class="fa-solid fa-circle-exclamation" style="color: #ff1414;"></i>
                            <p> Nível de temperatura registrado “-2º” do que esperado
                                (03-09-2023 03:42 ) </p>
                        </div>
                    </div>
                </div>
                <h2>KPI's Art Vision Tech</h2>
                <div class="container-row row2">
                    <div class="kpi-donut">
                        <canvas id="kpi_temperatura"></canvas>
                    </div>
                    <div class="kpi-donut">
                        <canvas id="kpi_umidade"></canvas>
                    </div>
                    <div class="kpi-donut">
                        <!-- <input type="text" id="input_ip" oninput="needleValue()" placeholder="IP">  -->
                        <canvas id="kpi_ip"></canvas>
                    </div>
                    
                </div>
            </div>
        </div>
    </div>
</body>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
</html>



<script>
    function tipoGrafico() {
        
        let tipo_grafico = select_grafico.value;
        console.log(tipo_grafico)
        if(tipo_grafico == "opt_umd") {
            kpi_chart.style.display = "none";
            kpi_chartUmd.style.display = "block";
        } else {
            kpi_chart.style.display = "block";
            kpi_chartUmd.style.display = "none";
        }

        // Função para alterar o gráfico
    }
    const ctx = document.getElementById('kpi_chart').getContext('2d');

    const chart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['0:00', '1:00', '2:00', '3:00', '4:00', '5:00', '6:00', '7:00', '8:00', '9:00', '10:00', '11:00', '12:00'],
            datasets: [
                {
                    yAxisID: 'A',
                    label: 'DHT11(1) Cº',
                    data: [18, 20, 20, 21, 22, 21, 23, 22, 23, 24, 24, 22, 23],
                    borderWidth: 1,
                    tension: 0.1,
                    backgroundColor: 'orange',
                    borderColor: 'orange'
                },
                {
                    yAxisID: 'B',
                    label: 'DHT11(2) Cº',
                    data: [19, 21, 21, 21, 23, 22, 23, 23, 24, 25, 26, 24, 23],
                    borderWidth: 1,
                    tension: 0.1,
                    backgroundColor: 'rgba(255, 118, 51, 0.8)',
                    borderColor: 'rgb(255, 118, 22)'
                },
            ]
        },
        options: {
            responsive: true,
            scales: {
                A: {
                    type: 'linear',
                    position: 'left',
                    ticks: { beginAtZero: true, color: 'orange', stepSize: 5},
                    grid: { display: false },
                    suggestedMin: 5,
                    suggestedMax: 35,
                },
                B: {
                    type: 'linear',
                    position: 'left',
                    display: false,
                    ticks: { beginAtZero: true, color: 'orange', stepSize: 5},
                    grid: { display: false },
                    suggestedMin: 5,
                    suggestedMax: 35,
                }
            },
        }
    });

    const ctxUmd = document.getElementById('kpi_chartUmd').getContext('2d');
    const chartUmd = new Chart(ctxUmd, {
        type: 'line',
        data: {
            labels: ['0:00', '1:00', '2:00', '3:00', '4:00', '5:00', '6:00', '7:00', '8:00', '9:00', '10:00', '11:00', '12:00'],
            datasets: [
                {
                    yAxisID: 'A',
                    label: 'DHT11(1) UR%',
                    data: [47, 55, 53, 60, 57, 51, 47, 46, 50, 52, 48, 56, 60],
                    borderWidth: 1,
                    backgroundColor: 'blue',
                    borderColor: 'blue'
                },
                {
                    yAxisID: 'B',
                    label: 'DHT11(2) UR%',
                    data: [50, 52, 50, 56, 53, 49, 47, 42, 47, 50, 46, 51, 54],
                    borderWidth: 1,
                    backgroundColor: 'rgba(0, 142, 252, 0.8)',
                    borderColor: 'rgb(0, 31, 252)'
                }  
            ]
        },
        options: {
            responsive: true,
            scales: {                
               A: {
                    type: 'linear',
                    position: 'left',
                    ticks: { beginAtZero: true, color: 'blue', stepSize: 10 },
                    grid: { display: false },
                    suggestedMin: 10,
                    suggestedMax: 90,
                },
                x: { ticks: { beginAtZero: true } } ,
                B: {
                    type: 'linear',
                    position: 'left',
                    display: false,
                    ticks: { beginAtZero: true, color: 'blue', stepSize: 5},
                    grid: { display: false },
                    suggestedMin: 10,
                    suggestedMax: 90,
                }
            }
        }
    });
</script>

<!-- Chart JS KPIS -->

<script>
    const ctxTemp = document.getElementById('kpi_temperatura').getContext('2d');
    const ctxUr = document.getElementById('kpi_umidade').getContext('2d');
    const ctxIp = document.getElementById('kpi_ip').getContext('2d');

    const dataValueTemp = [91.67, 8.33] 
    const dataTemp = {
        labels: ['Temperatura Ideal',],
        datasets: [{
            label: 'Temperatura',
            data: dataValueTemp,
            backgroundColor: ['rgba(255, 118, 51, 0.8)', 'rgba(255, 255, 255, 1)'],
            borderColor: ['rgb(255, 118, 22)', 'rgb(255, 118, 22)'],
            borderWidth: 1,
            cutout: '75%',
            radius: '90%',
        }]
    }

    const textoPorcentagemTemp = {
        id: 'textoPorcentagemTemp',
        afterDatasetsDraw(chart, args, pluginOptions) {
            const { ctx } = chart;
            ctx.save();
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.font = 'bold 21px sans-serif';
            ctx.fillStyle = '#ff7616'
            const texto = `${dataValueTemp[0]}%`; 
            const textoWidth = ctx.measureText(texto).width

            const x = chart.getDatasetMeta(0).data[0].x;
            const y = chart.getDatasetMeta(0).data[0].y;
            ctx.fillText(texto, x, y);
            
        }
    }

    const configTemp = {
        type: 'doughnut',
        data: dataTemp,
        options: {
            plugins: {
                title: {
                    display: true,
                    text: 'Temperatura',
                    color: '#ff7616',
                    font: {
                        size: 20,
                    }
                }
            }
        },
        plugins: [textoPorcentagemTemp],
    }

    const dataValueUr = [79.17,20.83] 
    const dataUr = {
        labels: ['Umidade ideal'],
        datasets: [{
            label: 'Umidade',
            data: dataValueUr,
            backgroundColor: ['rgba(0, 142, 252, 0.8)', 'rgba(255, 255, 255, 1)'],
            borderColor: ['rgb(0, 31, 252)', 'rgb(0, 31, 252)'],
            borderWidth: 1,
            cutout: '75%',
            radius: '90%',
        }]
    }

    const textoPorcentagemUr = {
        id: 'textoPorcentagemUr',
        afterDatasetsDraw(chart, args, pluginOptions) {
            const {ctx} = chart;
            ctx.save();
            ctx.textAlign = 'center';       
            ctx.textBaseline = 'middle';
            ctx.font = 'bold 21px sans-serif';
            ctx.fillStyle = '#001ffc'
            const texto = `${dataValueUr[0]}%`; 
            const textoWidth = ctx.measureText(texto).width 


            const x = chart.getDatasetMeta(0).data[0].x;
            const y = chart.getDatasetMeta(0).data[0].y;
            ctx.fillText(texto, x, y); 
        }
    }

    const configUr = {
        type: 'doughnut',
        data: dataUr,
        options: {
            plugins: {
                title: {
                    display: true,
                    text: 'Umidade',
                    color: '#001ffc',
                    font: {
                        size: 20,
                    }
                }
            }
        },
        plugins: [textoPorcentagemUr],
    }

/*     function needleValue() {
        let valor_ip = Number(input_ip.value);
        return valor_ip;
    } */



    // const dataIp = {
    //     labels: ['Perigo', 'Ok', 'Bom'],
    //     datasets: [{
    //         label: 'IETP',
    //         data: [30, 40,30],
    //         backgroundColor: ['rgba(255, 0, 0, 0.8)','rgba(240, 240, 240, 1)','rgba(7, 160, 0, 0.8)'],
    //         borderColor: ['rgb(201, 5, 0)', 'rgba(255, 255, 255, 1)','rgb(7, 109, 0)'],
    //         borderWidth: 1,
    //         circumference: 180,
    //         rotation: 270,
    //         cutout: '90%',
    //         needleValue: /* needleValue() */ 53,
    //         radius: '80%',
    //     }]
    // }

    /* Gráfico velocimetro */

    // const gaugeNeedle = {
    //     id: 'gaugeNeedle',
    //     afterDatasetsDraw(grafico, args, plugins) {
    //         const {ctx, data} = grafico;

    //         ctx.save(); 
            

    //         const needleValue = data.datasets[0].needleValue;
    //         const xCenter = grafico.getDatasetMeta(0).data[0].x;
    //         const yCenter = grafico.getDatasetMeta(0).data[0].y;
    //         const outerRadius = grafico.getDatasetMeta(0).data[0].outerRadius - 6;
    //         const angle = Math.PI;

    //         const dataTotal = data.datasets[0].data.reduce((a, b) => 
    //             a + b, 0) 
    //         let circumference = ((grafico.getDatasetMeta(0).data[0].
    //         circumference / Math.PI) / data.datasets[0].data[0]) * needleValue;
    //         const needleValueAngle = circumference + 1.5;
            
    //         ctx.translate(xCenter, yCenter);
    //         ctx.rotate(angle * needleValueAngle);

    //         // Ponteiro
    //         ctx.beginPath();
    //         ctx.strokeStyle = 'darkgrey';
    //         ctx.fillStyle = 'darkgrey';
    //         ctx.moveTo(0 - 5, 0);
    //         ctx.lineTo(0,  - outerRadius);
    //         ctx.lineTo(0 + 5, 0);
    //         ctx.stroke();
    //         ctx.fill();

    //         // Ponto
    //         ctx.beginPath();
    //         ctx.arc(0, 0, 10, angle * 0, angle *2, false);
    //         ctx.fill();
    //         ctx.restore();  
    //     }
    // }


    const data = {
        labels: ['Ótimo', 'Normal', 'Ruim'],
        datasets: [{
            label: 'IETP',
            data: [10, 9, 5],
            backgroundColor: [
                'rgb(3, 166, 60)',
                'rgba(159, 159, 159)',
                'rgba(250, 0, 0)',
            ],
            color: 'rgb(3, 166, 60)',
            borderWidth: 1
        }]
    };

    // Calculate percentages
    const total = data.datasets[0].data.reduce((acc, value) => acc + value, 0);
    const percentages = data.datasets[0].data.map(value => ((value / total) * 100).toFixed(2));


    // config
    const config = {
        type: 'pie',
        data: {
            labels: data.labels.map((label, index) => `${label}`),
            datasets: [{
                label: 'IETP',
                data: percentages,
                backgroundColor: data.datasets[0].backgroundColor,
                borderWidth: 1,
                color: '#03A63C',
            }]
        },
        options: {
            scales: {},
            plugins: {
                tooltip: {
                    enabled: false
                },
                datalabels: {
                    color: 'rgb(255, 255, 255)',
                    font: {
                        size: 14
                    }
                },
            },
        },
        plugins: [ChartDataLabels]
    };

    const kpiTemp = new Chart(ctxTemp, configTemp);
    const kpiUr = new Chart(ctxUr, configUr);
    new Chart(ctxIp, config);
    // const kpiIp = new Chart(ctxIp, configIp);
</script>