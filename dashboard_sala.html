<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <!-- Link onde são fornecidos os ícones  -->
    <link href='https://fonts.googleapis.com/css?family=Inter' rel='stylesheet'>
    <!-- Link para o google fonts, por enquanto estaremos utilizando a fonte 'Inter' -->
    <link rel="stylesheet" href="css/sistema_style.css">
    <!-- Css padrão para a estilização da parte do sistema do site -->
    <link rel="stylesheet" href="css/dashboard_sala.css">
    <!-- Css padrão para a estilização da parte do sistema do site -->
    <title>Dashboard Sala</title>
</head>

<body>
    <div class="header">
        <div id="perfil">
            <p> Henrique </p>
            <img id="perfil-avatar" src="https://cdn-icons-png.flaticon.com/512/3106/3106773.png" alt="Foto de perfil">
        </div>
    </div>
    <div id="sidebar"> <!-- Div que representa o elemento menu  -->
        <img id="logo" src="/img/logo_museu.png" alt="Logo Museu">
        <!-- Imagem da logo do museus cadastrado no sistema -->
        <div id="sidebar-menu">
            <a class="active" href="dashboard.html"> <i class="fa fa-fw fa-solid fa-table-cells-large"></i> Sensores
            <a href="linha_do_tempo.html"> <i class="fa fa-fw fa-solid fa-timeline"></i> Linha do Tempo </a>
            <a href="relatorio.html"> <i class="fa fa-fw fa-regular fa-clipboard"></i> Relátorios </a>
            <a href="ajustes.html"> <i class="fa fa-fw fa-solid fa-gear"></i> Ajustes </a>
            </a>
            <a href="login.html"> <i class="fa fa-fw fa-solid fa-arrow-right-from-bracket"></i> Sair </a>
        </div>
    </div>
    <div class="rigth-content"> <!-- Seção onde será inserido o conteúdo do sistema-->
        <div class="container-bg-content">
            <div class="container-header"> 
                <p> <a href="dashboard.html"> <i class="fa fa-fw fa-solid fa-arrow-left"></i> </a>  Galeria de arte 2° andar - norte </p>
            </div> 
            <div class="container-main-content">
                <div class="container-row row1">
                    <div class="container-column">
                        <div class="grafico">
                            <canvas id="kpi_chart"></canvas>
                            <canvas id="kpi_chartUmd" style="display: none;"></canvas>
                        </div>
                        <div>
                            <select name="select_grafico" id="select_grafico" onchange="tipoGrafico()">
                                <option value="opt_temp"> Temperatura </option>
                                <option value="opt_umd"> Umidade </option>
                            </select>
                            <!-- <button class="botao-select" > Atualizar </button> -->
                        </div>
                        <table class="tabela-sensor">
                            <thead>
                                <tr>
                                    <th> ID </th>
                                    <th> Sensor </th>
                                    <th> Valor Mínimo </th>
                                    <th> Valor Máximo </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>1</td>
                                    <td> DHT11 - 1</td>
                                    <td>19º</td>
                                    <td>24º</td>
                                </tr>
                                <tr>
                                    <td>1</td>
                                    <td>DHT11 - 1</td>
                                    <td>40%</td>
                                    <td>60%</td>
                                </tr>
                                <tr>
                                    <td>2</td>
                                    <td>DHT11 - 2</td>
                                    <td>20º</td>
                                    <td>25º</td>
                                </tr>
                                <tr>
                                    <td>2</td>
                                    <td>DHT11 - 2</td>
                                    <td>30%</td>
                                    <td>55%</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="container-log">
                        <div class="log-header">
                            <p> Histórico de registro </p>
                        </div>
                        <div class="log-mensagem">
                            <i class="fa-solid fa-circle-exclamation" style="color: #ff1414;"></i>
                            <p> Nível de temperatura registrado “+6º” do que esperado
                                (03-09-2023 15:24 ) </p>
                        </div>
                        <div class="log-mensagem">
                            <i class="fa-solid fa-circle-exclamation" style="color: #ff1414;"></i>
                            <p> Nível de umidade registrado “+3%” do que esperado
                                (03-09-2023 04:02 )</p>
                        </div>
                        <div class="log-mensagem">
                            <i class="fa-solid fa-circle-exclamation" style="color: #ff1414;"></i>
                            <p> Nível de umidade registrado “+4%” do que esperado
                                (03-09-2023 03:52 ) </p>
                        </div>
                        <div class="log-mensagem">
                            <i class="fa-solid fa-circle-exclamation" style="color: #ff1414;"></i>
                            <p> Nível de temperatura registrado “-2º” do que esperado
                                (03-09-2023 03:42 ) </p>
                        </div>
                    </div>
                </div>
                <h2>KPI's Art Vision Tech</h2>
                <div class="container-row row2">
                    <div class="kpi-donut">
                        <canvas id="kpi_temperatura"></canvas>
                    </div>
                    <div class="kpi-donut">
                        <canvas id="kpi_umidade"></canvas>
                    </div>
                    <div class="kpi-donut">
                        <canvas id="kpi_ip"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</html>



<script>
    function tipoGrafico() {
        
        let tipo_grafico = select_grafico.value;
        console.log(tipo_grafico)
        if(tipo_grafico == "opt_umd") {
            kpi_chart.style.display = "none";
            kpi_chartUmd.style.display = "block";
        } else {
            kpi_chart.style.display = "block";
            kpi_chartUmd.style.display = "none";
        }

        // Função para alterar o gráfico
    }
    const ctx = document.getElementById('kpi_chart').getContext('2d');

    const chart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['0:00', '1:00', '2:00', '3:00', '4:00', '5:00', '6:00', '7:00', '8:00', '9:00', '10:00', '11:00', '12:00'],
            datasets: [
                {
                    yAxisID: 'A',
                    label: 'Temperatura Cº',
                    data: [18, 20, 20, 21, 22, 21, 23, 22, 23, 24, 24, 22, 23],
                    borderWidth: 1,
                    tension: 0.1,
                    backgroundColor: 'orange',
                    borderColor: 'orange'
                },
            ]
        },
        options: {
            responsive: true,
            scales: {
                A: {
                    type: 'linear',
                    position: 'left',
                    ticks: { beginAtZero: true, color: 'orange', stepSize: 5},
                    grid: { display: false },
                    suggestedMin: 5,
                    suggestedMax: 35,
                    
                },
            },
        }
    });

    const ctxUmd = document.getElementById('kpi_chartUmd').getContext('2d');
    const chartUmd = new Chart(ctxUmd, {
        type: 'line',
        data: {
            labels: ['0:00', '1:00', '2:00', '3:00', '4:00', '5:00', '6:00', '7:00', '8:00', '9:00', '10:00', '11:00', '12:00'],
            datasets: [
                {
                    yAxisID: 'A',
                    label: 'Umidade Relativa %',
                    data: [47, 55, 53, 60, 57, 51, 47, 46, 50, 52, 48, 56, 60],
                    borderWidth: 1,
                    backgroundColor: 'blue',
                    borderColor: 'blue'
                } 
            ]
        },
        options: {
            responsive: true,
            scales: {                
               A: {
                    type: 'linear',
                    position: 'left',
                    ticks: { beginAtZero: true, color: 'blue', stepSize: 10 },
                    grid: { display: false },
                    suggestedMin: 10,
                    suggestedMax: 90,
                },
                x: { ticks: { beginAtZero: true } } 
            }
        }
    });
</script>

<script>
    const ctxTemp = document.getElementById('kpi_temperatura').getContext('2d');
    const ctxUr = document.getElementById('kpi_umidade').getContext('2d');
    const ctxIp = document.getElementById('kpi_ip').getContext('2d');

    const dataTemp = {
        labels: ['Atingido', 'Restante'],
        datasets: [{
            label: 'Temperatura',
            data: [90, 10],
            backgroundColor: ['rgba(255, 118, 51, 0.8)', 'rgba(255, 255, 255, 1)'],
            borderColor: ['rgb(255, 118, 22)', 'rgb(255, 118, 22)'],
            borderWidth: 1
        }]
    }

    const dataUr = {
        labels: ['Atingido', 'Restante'],
        datasets: [{
            label: 'Umidade',
            data: [80, 20],
            backgroundColor: ['rgba(0, 142, 252, 0.8)', 'rgba(255, 255, 255, 1)'],
            borderColor: ['rgb(0, 31, 252)', 'rgb(0, 31, 252)'],
            borderWidth: 1
        }]
    }
    const dataIp = {
        labels: ['Perigo', 'Ok', 'Bom'],
        datasets: [{
            label: 'TWIP',
            data: [30, 40,30],
            backgroundColor: ['rgba(255, 0, 0, 0.8)','rgba(240, 240, 240, 1)','rgba(7, 160, 0, 0.8)'],
            borderColor: ['rgb(201, 5, 0)', 'rgba(250, 250, 250, 0.8)','rgb(7, 109, 0)'],
            borderWidth: 1,
            circumference: 180,
            rotation: 270,
            cutout: '90%',
            needleValue: 50,
        }]
    }

    const configTemp = {
        type: 'doughnut',
        data: dataTemp,
        options: {
            plugins: {
                title: {
                    display: true,
                    text: 'Temperatura',
                    color: '#ff7616',
                    font: {
                        size: 20,
                    }
                }
            }
        }
    }

    const configUr = {
        type: 'doughnut',
        data: dataUr,
        options: {
            plugins: {
                title: {
                    display: true,
                    text: 'Umidade',
                    color: '#001ffc',
                    font: {
                        size: 20,
                    }
                }
            }
        }
    }

    /* Gráfico velocimetro */

    const gaugeNeedle = {
        id: 'gaugeNeedle',
        afterDatasetsDraw(grafico, args, plugins) {
            const {ctx, data} = grafico;

            ctx.save();

            const needleValue = data.datasets[0].needleValue;
            const xCenter = grafico.getDatasetMeta(0).data[0].x;
            const yCenter = grafico.getDatasetMeta(0).data[0].y;
            const outerRadius = grafico.getDatasetMeta(0).data[0].outerRadius - 6;
            const angle = Math.PI;

            const dataTotal = data.datasets[0].data.reduce((a, b) => 
                a + b, 0) 
            let circumference = ((grafico.getDatasetMeta(0).data[0].
            circumference / Math.PI) / data.datasets[0].data[0]) * needleValue;
            const needleValueAngle = circumference + 1.5;
            
            ctx.translate(xCenter, yCenter);
            ctx.rotate(angle * needleValueAngle);

            // Ponteiro
            ctx.beginPath();
            ctx.strokeStyle = 'darkgrey';
            ctx.fillStyle = 'darkgrey';
            ctx.moveTo(0 - 5, 0);
            ctx.lineTo(0,  - outerRadius);
            ctx.lineTo(0 + 5, 0);
            ctx.stroke();
            ctx.fill();

            // Ponto
            ctx.beginPath();
            ctx.arc(0, 0, 10, angle * 0, angle *2, false);
            ctx.fill();
            ctx.restore();  
        }
    }

    const configIp = {
        type: 'doughnut',
        data: dataIp,
        options: {
            aspectRatio: 1.2,
            plugins: {
                title: {
                    display: true,
                    text: 'IP',
                    color: '#07a000',
                    font: {
                        size: 20,
                    }
                },
                legend: {
                    display: true,
                }
            }
        },
        plugins: [gaugeNeedle]
    }

    const kpiTemp = new Chart(ctxTemp, configTemp);
    const kpiUr = new Chart(ctxUr, configUr);
    const kpiIp = new Chart(ctxIp, configIp);
</script>